{"ast":null,"code":"var _jsxFileName = \"D:\\\\Downloads\\\\astro-main\\\\frontend\\\\src\\\\components\\\\ExpandableChat.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport './ExpandableChat.css';\nimport astroBotAPI from '../services/api';\nimport KundliChart from './KundliChart';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ExpandableChat = ({\n  isOpen,\n  onClose,\n  onRefresh,\n  userData\n}) => {\n  _s();\n  const [messages, setMessages] = useState([{\n    id: 1,\n    text: \"Jai Shri Ram ðŸ™ Swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon.\",\n    sender: 'pandit',\n    timestamp: new Date().toLocaleTimeString()\n  }, {\n    id: 2,\n    text: \"Aapka naam kya hai aur kis vishay par margdarshan chahte hain? Pehle apna naam batayiye (e.g., Mera naam Rajesh hai).\",\n    sender: 'pandit',\n    timestamp: new Date().toLocaleTimeString()\n  }]);\n  const [inputText, setInputText] = useState('');\n  const [userProfile, setUserProfile] = useState({\n    name: '',\n    dob: '',\n    tob: '',\n    place: '',\n    timezone: 'Asia/Kolkata'\n  });\n  const [kundliData, setKundliData] = useState(null);\n  const [chartData, setChartData] = useState(null);\n  const [isGeneratingKundli, setIsGeneratingKundli] = useState(false);\n  const [isGeneratingChart, setIsGeneratingChart] = useState(false);\n  // Steps: ask_name, ask_dob, ask_tob, ask_place, confirm_details, generating, chart_generated, chatting\n  const [currentStep, setCurrentStep] = useState('ask_name');\n  const messagesEndRef = React.useRef(null);\n  const inputRef = React.useRef(null);\n  const [editMode, setEditMode] = useState(false);\n  const messageIdRef = React.useRef(3);\n  const [isBotTyping, setIsBotTyping] = useState(false);\n  // Ensure chart is generated only once per chat session\n  const hasGeneratedRef = React.useRef(false);\n\n  // When userData is provided (from the modal form), greet the user by name and prefill profile\n  React.useEffect(() => {\n    if (userData && userData.name) {\n      setUserProfile(prev => ({\n        ...prev,\n        name: userData.name,\n        dob: userData.dob || prev.dob,\n        tob: userData.tob || prev.tob,\n        place: userData.place || prev.place,\n        timezone: userData.timezone || prev.timezone\n      }));\n\n      // Personalized spiritual greeting\n      setMessages([{\n        id: 1,\n        text: `Jai Shri Ram ðŸ™ ${userData.name} ji, swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon. Aap kaise hain?`,\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      }, {\n        id: 2,\n        text: \"Main abhi aapka Kundli chart taiyar kar raha hun... Kripya thoda wait karein, grahon ki sthiti dekhni hai.\",\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      }]);\n      const haveAll = userData.dob && userData.tob && userData.place;\n      if (haveAll) {\n        // Auto-generate chart when all details are available\n        if (!hasGeneratedRef.current) {\n          setCurrentStep('generating');\n          const details = {\n            name: userData.name,\n            dob: userData.dob,\n            tob: userData.tob,\n            place: userData.place,\n            timezone: userData.timezone || 'Asia/Kolkata'\n          };\n          // Small buffer to ensure state propagation is complete\n          setTimeout(() => {\n            if (!hasGeneratedRef.current) {\n              generateKundli(details);\n            }\n          }, 150);\n        }\n      } else {\n        setCurrentStep('ask_dob');\n      }\n    }\n  }, [userData]);\n  const nextMessageId = () => {\n    const id = messageIdRef.current;\n    messageIdRef.current += 1;\n    return id;\n  };\n\n  // Handle refresh - clear messages and reset to initial state\n  React.useEffect(() => {\n    if (onRefresh) {\n      const resetMessages = () => {\n        setMessages([{\n          id: 1,\n          text: \"Jai Shri Ram ðŸ™ Swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon.\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        }, {\n          id: 2,\n          text: \"Aapka naam kya hai aur kis vishay par margdarshan chahte hain? Pehle apna naam batayiye (e.g., Mera naam Rajesh hai).\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        }]);\n        setInputText('');\n        setUserProfile({\n          name: '',\n          dob: '',\n          tob: '',\n          place: '',\n          timezone: 'Asia/Kolkata'\n        });\n        setKundliData(null);\n        hasGeneratedRef.current = false;\n        setCurrentStep('ask_name');\n        setEditMode(false);\n      };\n\n      // Listen for refresh events\n      const handleRefresh = () => {\n        resetMessages();\n      };\n\n      // Store the handler so we can clean it up\n      window.addEventListener('refreshChat', handleRefresh);\n      return () => {\n        window.removeEventListener('refreshChat', handleRefresh);\n      };\n    }\n  }, [onRefresh]);\n\n  // Auto-scroll to latest message\n  React.useEffect(() => {\n    try {\n      var _messagesEndRef$curre;\n      (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n        behavior: 'smooth'\n      });\n    } catch (e) {\n      // ignore scroll errors\n    }\n  }, [messages, isGeneratingKundli, isGeneratingChart, chartData]);\n\n  // Auto-focus input when chat opens or bot finished typing\n  React.useEffect(() => {\n    if (isOpen && !isBotTyping && !isGeneratingKundli) {\n      try {\n        var _inputRef$current;\n        (_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.focus();\n      } catch (e) {}\n    }\n  }, [isOpen, isBotTyping, isGeneratingKundli]);\n\n  // NLP helpers for stepwise extraction\n  const parseName = text => {\n    const input = text.trim();\n    const cleanup = raw => {\n      if (!raw) return null;\n      // Remove trailing Hindi copula words like 'hai', 'hun', 'hu'\n      let name = raw.replace(/\\b(hai|hun|hu|hoon)\\b\\.?$/i, '').trim();\n      // Remove trailing punctuation\n      name = name.replace(/[.,;:!?]+$/g, '').trim();\n      // Collapse multiple spaces\n      name = name.replace(/\\s{2,}/g, ' ');\n      return name || null;\n    };\n\n    // 1) \"mera naam <name> hai\" (common Hindi pattern)\n    let m = input.match(/(?:^|\\b)mera\\s+naam\\s+([a-zA-Z][a-zA-Z\\s'.-]*?)(?:\\s+(?:hai|hun|hu|hoon))?\\b/i);\n    if (m) return cleanup(m[1]);\n\n    // 2) \"my name is <name>\"\n    m = input.match(/(?:^|\\b)my\\s+name\\s+is\\s+([a-zA-Z][a-zA-Z\\s'.-]+)$/i);\n    if (m) return cleanup(m[1]);\n\n    // 3) \"I am <name>\" or \"I'm <name>\"\n    m = input.match(/^(?:i\\s*am|i'm)\\s+([a-zA-Z][a-zA-Z\\s'.-]+)$/i);\n    if (m) return cleanup(m[1]);\n\n    // 4) Bare name fallback (single or multi-word letters only)\n    m = input.match(/^([a-zA-Z][a-zA-Z\\s'.-]{1,})$/);\n    if (m) return cleanup(m[1]);\n    return null;\n  };\n  const parseDob = text => {\n    const monthNames = ['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'];\n    const monthShort = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];\n    let m;\n    m = text.match(/(\\d{4})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{1,2})/); // YYYY-MM-DD\n    if (m) return `${m[1]}-${m[2].padStart(2, '0')}-${m[3].padStart(2, '0')}`;\n    m = text.match(/(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{4})/); // DD-MM-YYYY or MM-DD-YYYY\n    if (m) {\n      const a = parseInt(m[1], 10),\n        b = parseInt(m[2], 10);\n      // Heuristic: if both <=12, assume DD-MM-YYYY by default\n      const day = a;\n      const month = b;\n      return `${m[3]}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;\n    }\n    m = text.match(/(\\d{1,2})\\s+(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\\s+(\\d{4})/i);\n    if (m) {\n      const month = monthNames.indexOf(m[2].toLowerCase()) !== -1 ? monthNames.indexOf(m[2].toLowerCase()) + 1 : monthShort.indexOf(m[2].toLowerCase()) + 1;\n      return `${m[3]}-${month.toString().padStart(2, '0')}-${m[1].padStart(2, '0')}`;\n    }\n    return null;\n  };\n  const parseTob = text => {\n    let m = text.match(/(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(am|pm)?/i);\n    if (!m) m = text.match(/(\\d{1,2})[\\.\\s](\\d{2})\\s*(am|pm)?/i);\n    if (m) {\n      let hour = parseInt(m[1], 10);\n      const minute = m[2];\n      const sec = m[3] || '00';\n      const period = m[4] || m[3] || '';\n      if (/pm/i.test(period) && hour !== 12) hour += 12;\n      if (/am/i.test(period) && hour === 12) hour = 0;\n      if (hour >= 0 && hour <= 23) return `${hour.toString().padStart(2, '0')}:${minute}:${sec}`;\n    }\n    return null;\n  };\n  const parsePlace = text => {\n    const m = text.match(/(?:place|sthan|city|town|birth\\s*place|janm\\s*sthan|from|in)\\s*:?\\s*([a-zA-Z][a-zA-Z\\s,.'-]+)/i);\n    if (m) return m[1].trim();\n    // Fallback: single word or two words capitalized\n    const m2 = text.match(/^[a-zA-Z][a-zA-Z\\s'.-]{2,}$/);\n    if (m2) return m2[0].trim();\n    return null;\n  };\n  const isValidDate = yyyyMmDd => {\n    if (!yyyyMmDd) return false;\n    const m = yyyyMmDd.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (!m) return false;\n    const d = new Date(`${m[1]}-${m[2]}-${m[3]}T00:00:00Z`);\n    return !isNaN(d.getTime());\n  };\n  const isValidTime = hhmmss => /^(\\d{2}):(\\d{2}):(\\d{2})$/.test(hhmmss);\n\n  // Helper function to check if all birth details are collected\n  const isProfileComplete = () => {\n    return userProfile.name && userProfile.dob && userProfile.tob && userProfile.place;\n  };\n\n  // Helper function to generate Kundli and then Chart (sequential flow)\n  // Accepts optional details to avoid relying on possibly stale state\n  const generateKundli = async detailsOverride => {\n    if (hasGeneratedRef.current) return; // already generated, skip\n    setIsGeneratingKundli(true);\n    setIsGeneratingChart(true);\n    setCurrentStep('generating');\n    try {\n      const birthDetails = detailsOverride || {\n        name: userProfile.name,\n        dob: userProfile.dob,\n        tob: userProfile.tob,\n        place: userProfile.place,\n        timezone: userProfile.timezone\n      };\n      // 1) Generate Kundli first\n      const kundliResponse = await astroBotAPI.generateKundli(birthDetails);\n      if (!kundliResponse.success || !kundliResponse.chart_data) {\n        throw new Error(kundliResponse.error || 'Kundli generation failed');\n      }\n      setKundliData(kundliResponse.chart_data);\n\n      // Add Kundli generation success message with warm greeting and remedy promise\n      const successMessage = {\n        id: nextMessageId(),\n        text: `ðŸŽ‰ Bahut badhiya ${userProfile.name} ji! Aapka Kundli taiyar ho gaya hai. Ab main visual chart generate kar raha hun...`,\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages(prev => [...prev, successMessage]);\n\n      // 2) Only after Kundli succeeds, generate Chart\n      const chartResponse = await astroBotAPI.generateChart(birthDetails);\n      if (chartResponse.success && chartResponse.chart_data) {\n        setChartData(chartResponse.chart_data);\n        setIsGeneratingChart(false);\n        setCurrentStep('chart_generated');\n        hasGeneratedRef.current = true;\n\n        // Optional: confirm chart readiness\n        setMessages(prev => [...prev, {\n          id: nextMessageId(),\n          text: 'ðŸ—ºï¸ Visual chart ready! Aap apne prashn puch sakte hain.',\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        }]);\n      } else {\n        throw new Error(chartResponse.error || 'Chart generation failed');\n      }\n    } catch (error) {\n      console.error('Error generating Kundli:', error);\n      const errorMessage = {\n        id: nextMessageId(),\n        text: \"Sorry, Kundli generate karne mein koi problem aa rahi hai. Kripya dobara try karein ya contact karein.\",\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsGeneratingKundli(false);\n    }\n  };\n  const handleSendMessage = async () => {\n    if (inputText.trim()) {\n      const newMessage = {\n        id: nextMessageId(),\n        text: inputText,\n        sender: 'user',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages([...messages, newMessage]);\n      const currentInput = inputText;\n      setInputText('');\n      try {\n        var _botText;\n        // Show typing indicator\n        const typingMessage = {\n          id: nextMessageId(),\n          text: \"Pandit ji typing...\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString(),\n          isTyping: true\n        };\n        setIsBotTyping(true);\n        setMessages(prev => [...prev, typingMessage]);\n\n        // Stepwise dialog\n        let botText = '';\n        if (currentStep === 'ask_name') {\n          // allow corrections like: name: Rajesh\n          let name = null;\n          const correction = currentInput.match(/^(?:name|naam)\\s*[:\\-]\\s*(.+)$/i);\n          if (correction) name = correction[1].trim();\n          if (!name) name = parseName(currentInput);\n          if (!name) {\n            botText = \"Kripya apna naam clear tarike se batayiye (e.g., Mera naam Anil hai).\";\n          } else {\n            const updated = {\n              ...userProfile,\n              name\n            };\n            setUserProfile(updated);\n            setCurrentStep('ask_dob');\n            botText = `${name} ji, ab apni janm tithi batayiye (e.g., 15/05/1990 ya 15 May 1990).`;\n          }\n        } else if (currentStep === 'ask_dob') {\n          const dob = parseDob(currentInput);\n          if (!dob || !isValidDate(dob)) {\n            botText = \"Janm tithi samajh nahi aayi. Kripya format mein batayein: DD/MM/YYYY ya 15 May 1990.\";\n          } else {\n            const updated = {\n              ...userProfile,\n              dob\n            };\n            setUserProfile(updated);\n            setCurrentStep('ask_tob');\n            botText = \"Shukriya. Ab apna janm samay batayiye (e.g., 2:30 PM ya 14:30).\";\n          }\n        } else if (currentStep === 'ask_tob') {\n          const tob = parseTob(currentInput);\n          if (!tob || !isValidTime(tob)) {\n            botText = \"Janm samay samajh nahi aaya. Kripya format mein batayein: HH:MM AM/PM ya 24-hour (e.g., 14:30).\";\n          } else {\n            const updated = {\n              ...userProfile,\n              tob\n            };\n            setUserProfile(updated);\n            setCurrentStep('ask_place');\n            botText = \"Samay mil gaya. Ab apna janm sthan/city batayiye (e.g., Delhi, Mumbai).\";\n          }\n        } else if (currentStep === 'ask_place') {\n          const place = parsePlace(currentInput);\n          if (!place) {\n            botText = \"Janm sthan samajh nahi aaya. Kripya city ka naam batayein (e.g., Pune).\";\n          } else {\n            const updated = {\n              ...userProfile,\n              place\n            };\n            setUserProfile(updated);\n            setCurrentStep('confirm_details');\n            botText = `Kripya confirm karein:\\n- Naam: ${updated.name}\\n- DOB: ${updated.dob}\\n- TOB: ${updated.tob}\\n- Place: ${updated.place}\\nType karein: 'yes' ya jis field ko change karna ho: 'change name: <naya naam>'`;\n          }\n        } else if (currentStep === 'confirm_details') {\n          if (/^y(es)?$/i.test(currentInput.trim())) {\n            botText = \"Bahut badiya! Main aapka Kundli chart generate kar raha hun...\";\n            setCurrentStep('generating');\n            // proceed without removing typing bubble\n            setMessages(prev => prev.filter(msg => !msg.isTyping).concat({\n              id: nextMessageId(),\n              text: botText,\n              sender: 'pandit',\n              timestamp: new Date().toLocaleTimeString()\n            }));\n            const details = {\n              name: userProfile.name,\n              dob: userProfile.dob,\n              tob: userProfile.tob,\n              place: userProfile.place,\n              timezone: userProfile.timezone\n            };\n            // Small buffer to ensure any last state changes settle\n            await new Promise(res => setTimeout(res, 150));\n            await generateKundli(details);\n            return;\n          }\n          const change = currentInput.match(/^change\\s+(name|naam|dob|date|tob|time|samay|place|city|sthan)\\s*[:\\-]\\s*(.+)$/i);\n          if (change) {\n            const field = change[1].toLowerCase();\n            const value = change[2].trim();\n            const updated = {\n              ...userProfile\n            };\n            if (field === 'name' || field === 'naam') updated.name = value;else if (field === 'dob' || field === 'date') {\n              const dob = parseDob(value);\n              if (dob && isValidDate(dob)) updated.dob = dob;else {\n                botText = \"Nayi DOB valid nahi hai. Example: 15/05/1990\";\n              }\n            } else if (field === 'tob' || field === 'time' || field === 'samay') {\n              const tob = parseTob(value);\n              if (tob && isValidTime(tob)) updated.tob = tob;else {\n                botText = \"Naya TOB valid nahi hai. Example: 2:30 PM ya 14:30\";\n              }\n            } else if (field === 'place' || field === 'city' || field === 'sthan') {\n              const place = parsePlace(value);\n              if (place) updated.place = place;else {\n                botText = \"Naya place samajh nahi aaya. Example: Jaipur\";\n              }\n            }\n            setUserProfile(updated);\n            if (!botText) {\n              botText = `Updated. Kripya confirm karein:\\n- Naam: ${updated.name}\\n- DOB: ${updated.dob}\\n- TOB: ${updated.tob}\\n- Place: ${updated.place}\\nType 'yes' ya 'change <field>: <value>'`;\n            }\n          } else {\n            botText = \"Kripya 'yes' type karein ya 'change <field>: <value>' batayein (e.g., change dob: 1990-05-15).\";\n          }\n        } else if (currentStep === 'chart_generated' || currentStep === 'chatting') {\n          // Regular chat with chart context; prefer Kundli data (has name and rich context)\n          const chartContext = kundliData || chartData || null;\n          const response = await astroBotAPI.sendChatMessage(currentInput, chartContext);\n          botText = response.response;\n          setCurrentStep('chatting');\n        } else if (currentStep === 'generating') {\n          botText = \"Chart generate ho raha hai, kripya wait karein...\";\n        }\n\n        // Smooth typing simulation with thoughtful delay for predictions (8-10 seconds)\n        const looksLikePrediction = /\\b(yog|shaadi|career|health|mangal|grah|kundli|prediction|yoga|marriage|job|business|future)\\b/i.test(botText || '');\n        const baseDelay = looksLikePrediction ? 8000 : 1200; // 8s+ for predictions, 1.2s for regular chat\n        const variableDelay = looksLikePrediction ? Math.min(2000, Math.floor((((_botText = botText) === null || _botText === void 0 ? void 0 : _botText.length) || 0) / 15) * 80) : 500;\n        const delayMs = baseDelay + variableDelay; // Total 8-10 seconds for predictions\n        await new Promise(res => setTimeout(res, delayMs));\n        // Remove typing indicator and add botText\n        setMessages(prev => {\n          const withoutTyping = prev.filter(msg => !msg.isTyping);\n          return [...withoutTyping, {\n            id: nextMessageId(),\n            text: botText,\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          }];\n        });\n        // Optionally add a gentle follow-up question to keep flow natural\n        if (currentStep === 'chatting' || currentStep === 'chart_generated') {\n          const followUps = [\"Abhi aapke rishte ki baat chal rahi hai kya?\", \"Kya aap kisi ko pasand karte ho?\", \"Aapka career kis field mein hai?\", \"Aapko apni health ke baare mein bhi jaana hai kya?\"];\n          const fupDelay = 1200 + Math.floor(Math.random() * 1200);\n          setTimeout(() => {\n            setMessages(prev => [...prev, {\n              id: nextMessageId(),\n              text: followUps[Math.floor(Math.random() * followUps.length)],\n              sender: 'pandit',\n              timestamp: new Date().toLocaleTimeString()\n            }]);\n          }, fupDelay);\n        }\n        setIsBotTyping(false);\n      } catch (error) {\n        console.error('Error sending message:', error);\n\n        // Remove typing indicator and show error\n        setMessages(prev => {\n          const withoutTyping = prev.filter(msg => !msg.isTyping);\n          const errorResponse = {\n            id: nextMessageId(),\n            text: \"Sorry, main abhi online nahi hun. Kripya thoda baad try karein.\",\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          };\n          return [...withoutTyping, errorResponse];\n        });\n        setIsBotTyping(false);\n      }\n    }\n  };\n  const handleKeyPress = e => {\n    if (e.key === 'Enter') {\n      handleSendMessage();\n    }\n  };\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `expandable-chat-container ${isOpen ? 'expanded' : ''}`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pandit-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pandit-avatar-small\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: require('../assets/Astro_Avatar.png'),\n            alt: \"Pandit ji\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 527,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 526,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pandit-details\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Pandit ji\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 530,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"status\",\n            children: \"Online\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 531,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 529,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 525,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 524,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages-container\",\n      children: [messages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `message ${message.sender}`,\n        children: [message.sender === 'pandit' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-avatar\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: require('../assets/Astro_Avatar.png'),\n            alt: \"Pandit ji\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 542,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 541,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-content\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-bubble\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: message.text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 547,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"message-time\",\n              children: message.timestamp\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 548,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 546,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 13\n        }, this)]\n      }, message.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 539,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 553,\n        columnNumber: 9\n      }, this), chartData && /*#__PURE__*/_jsxDEV(KundliChart, {\n        chartData: chartData,\n        onChartReady: () => {\n          // Chart is ready, no need for additional message\n          console.log('Chart loaded successfully');\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 557,\n        columnNumber: 11\n      }, this), (isGeneratingKundli || isGeneratingChart) && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"kundli-loading\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading-spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 569,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\uD83D\\uDD2E Aapka Kundli chart generate ho raha hai... Kripya wait karein\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 570,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 568,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 537,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"input-container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"input-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: inputText,\n          onChange: e => setInputText(e.target.value),\n          onKeyPress: handleKeyPress,\n          ref: inputRef,\n          placeholder: currentStep === 'greeting' || currentStep === 'collecting_details' ? \"Format: naam, DD/MM/YYYY, HH:MM, place (e.g., Rajesh, 15/05/1990, 14:30, Delhi)\" : \"Apna sawal yahan likhein...\",\n          className: \"message-input\",\n          disabled: isGeneratingKundli || isBotTyping\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 578,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSendMessage,\n          className: \"send-button\",\n          disabled: isGeneratingKundli || isBotTyping,\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            viewBox: \"0 0 24 24\",\n            className: \"send-icon\",\n            children: [/*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M22 2L11 13\",\n              stroke: \"currentColor\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 598,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M22 2L15 22L11 13L2 9L22 2Z\",\n              stroke: \"currentColor\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 599,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 597,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 592,\n          columnNumber: 11\n        }, this), (currentStep === 'confirm_details' || currentStep === 'chart_generated' || currentStep === 'chatting') && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            setEditMode(prev => !prev);\n            if (!editMode) {\n              // entering edit mode: show current details\n              const m = {\n                id: nextMessageId(),\n                text: `Edit mode enabled. Type: change name: <value> / change dob: <value> / change tob: <value> / change place: <value>. Then type 'save' to confirm.`,\n                sender: 'pandit',\n                timestamp: new Date().toLocaleTimeString()\n              };\n              setMessages(prev => [...prev, m]);\n            }\n          },\n          className: \"send-button\",\n          style: {\n            marginLeft: 8\n          },\n          children: editMode ? 'Done' : 'Edit details'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 603,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 577,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 522,\n    columnNumber: 5\n  }, this);\n};\n_s(ExpandableChat, \"9FrRX7Ad3bm9p0nopqmlZMeKXJY=\");\n_c = ExpandableChat;\nexport default ExpandableChat;\nvar _c;\n$RefreshReg$(_c, \"ExpandableChat\");","map":{"version":3,"names":["React","useState","astroBotAPI","KundliChart","jsxDEV","_jsxDEV","ExpandableChat","isOpen","onClose","onRefresh","userData","_s","messages","setMessages","id","text","sender","timestamp","Date","toLocaleTimeString","inputText","setInputText","userProfile","setUserProfile","name","dob","tob","place","timezone","kundliData","setKundliData","chartData","setChartData","isGeneratingKundli","setIsGeneratingKundli","isGeneratingChart","setIsGeneratingChart","currentStep","setCurrentStep","messagesEndRef","useRef","inputRef","editMode","setEditMode","messageIdRef","isBotTyping","setIsBotTyping","hasGeneratedRef","useEffect","prev","haveAll","current","details","setTimeout","generateKundli","nextMessageId","resetMessages","handleRefresh","window","addEventListener","removeEventListener","_messagesEndRef$curre","scrollIntoView","behavior","e","_inputRef$current","focus","parseName","input","trim","cleanup","raw","replace","m","match","parseDob","monthNames","monthShort","padStart","a","parseInt","b","day","month","toString","indexOf","toLowerCase","parseTob","hour","minute","sec","period","test","parsePlace","m2","isValidDate","yyyyMmDd","d","isNaN","getTime","isValidTime","hhmmss","isProfileComplete","detailsOverride","birthDetails","kundliResponse","success","chart_data","Error","error","successMessage","chartResponse","generateChart","console","errorMessage","handleSendMessage","newMessage","currentInput","_botText","typingMessage","isTyping","botText","correction","updated","filter","msg","concat","Promise","res","change","field","value","chartContext","response","sendChatMessage","looksLikePrediction","baseDelay","variableDelay","Math","min","floor","length","delayMs","withoutTyping","followUps","fupDelay","random","errorResponse","handleKeyPress","key","className","children","src","require","alt","fileName","_jsxFileName","lineNumber","columnNumber","map","message","ref","onChartReady","log","type","onChange","target","onKeyPress","placeholder","disabled","onClick","viewBox","stroke","strokeWidth","strokeLinecap","strokeLinejoin","style","marginLeft","_c","$RefreshReg$"],"sources":["D:/Downloads/astro-main/frontend/src/components/ExpandableChat.js"],"sourcesContent":["import React, { useState } from 'react';\nimport './ExpandableChat.css';\nimport astroBotAPI from '../services/api';\nimport KundliChart from './KundliChart';\n\nconst ExpandableChat = ({ isOpen, onClose, onRefresh, userData }) => {\n  const [messages, setMessages] = useState([\n    {\n      id: 1,\n      text: \"Jai Shri Ram ðŸ™ Swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon.\",\n      sender: 'pandit',\n      timestamp: new Date().toLocaleTimeString()\n    },\n    {\n      id: 2,\n      text: \"Aapka naam kya hai aur kis vishay par margdarshan chahte hain? Pehle apna naam batayiye (e.g., Mera naam Rajesh hai).\",\n      sender: 'pandit',\n      timestamp: new Date().toLocaleTimeString()\n    }\n  ]);\n  const [inputText, setInputText] = useState('');\n  const [userProfile, setUserProfile] = useState({\n    name: '',\n    dob: '',\n    tob: '',\n    place: '',\n    timezone: 'Asia/Kolkata'\n  });\n  const [kundliData, setKundliData] = useState(null);\n  const [chartData, setChartData] = useState(null);\n  const [isGeneratingKundli, setIsGeneratingKundli] = useState(false);\n  const [isGeneratingChart, setIsGeneratingChart] = useState(false);\n  // Steps: ask_name, ask_dob, ask_tob, ask_place, confirm_details, generating, chart_generated, chatting\n  const [currentStep, setCurrentStep] = useState('ask_name');\n  const messagesEndRef = React.useRef(null);\n  const inputRef = React.useRef(null);\n  const [editMode, setEditMode] = useState(false);\n  const messageIdRef = React.useRef(3);\n  const [isBotTyping, setIsBotTyping] = useState(false);\n  // Ensure chart is generated only once per chat session\n  const hasGeneratedRef = React.useRef(false);\n\n  // When userData is provided (from the modal form), greet the user by name and prefill profile\n  React.useEffect(() => {\n    if (userData && userData.name) {\n      setUserProfile(prev => ({\n        ...prev,\n        name: userData.name,\n        dob: userData.dob || prev.dob,\n        tob: userData.tob || prev.tob,\n        place: userData.place || prev.place,\n        timezone: userData.timezone || prev.timezone\n      }));\n\n      // Personalized spiritual greeting\n      setMessages([\n        {\n          id: 1,\n          text: `Jai Shri Ram ðŸ™ ${userData.name} ji, swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon. Aap kaise hain?`,\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        },\n        {\n          id: 2,\n          text: \"Main abhi aapka Kundli chart taiyar kar raha hun... Kripya thoda wait karein, grahon ki sthiti dekhni hai.\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        }\n      ]);\n\n      const haveAll = (userData.dob && userData.tob && userData.place);\n      if (haveAll) {\n        // Auto-generate chart when all details are available\n        if (!hasGeneratedRef.current) {\n          setCurrentStep('generating');\n          const details = {\n            name: userData.name,\n            dob: userData.dob,\n            tob: userData.tob,\n            place: userData.place,\n            timezone: userData.timezone || 'Asia/Kolkata'\n          };\n          // Small buffer to ensure state propagation is complete\n          setTimeout(() => {\n            if (!hasGeneratedRef.current) {\n              generateKundli(details);\n            }\n          }, 150);\n        }\n      } else {\n        setCurrentStep('ask_dob');\n      }\n    }\n  }, [userData]);\n\n  const nextMessageId = () => {\n    const id = messageIdRef.current;\n    messageIdRef.current += 1;\n    return id;\n  };\n\n  // Handle refresh - clear messages and reset to initial state\n  React.useEffect(() => {\n    if (onRefresh) {\n      const resetMessages = () => {\n        setMessages([\n          {\n            id: 1,\n            text: \"Jai Shri Ram ðŸ™ Swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon.\",\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          },\n          {\n            id: 2,\n            text: \"Aapka naam kya hai aur kis vishay par margdarshan chahte hain? Pehle apna naam batayiye (e.g., Mera naam Rajesh hai).\",\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          }\n        ]);\n        setInputText('');\n        setUserProfile({\n          name: '',\n          dob: '',\n          tob: '',\n          place: '',\n          timezone: 'Asia/Kolkata'\n        });\n        setKundliData(null);\n        hasGeneratedRef.current = false;\n        setCurrentStep('ask_name');\n        setEditMode(false);\n      };\n      \n      // Listen for refresh events\n      const handleRefresh = () => {\n        resetMessages();\n      };\n      \n      // Store the handler so we can clean it up\n      window.addEventListener('refreshChat', handleRefresh);\n      \n      return () => {\n        window.removeEventListener('refreshChat', handleRefresh);\n      };\n    }\n  }, [onRefresh]);\n\n  // Auto-scroll to latest message\n  React.useEffect(() => {\n    try {\n      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    } catch (e) {\n      // ignore scroll errors\n    }\n  }, [messages, isGeneratingKundli, isGeneratingChart, chartData]);\n\n  // Auto-focus input when chat opens or bot finished typing\n  React.useEffect(() => {\n    if (isOpen && !isBotTyping && !isGeneratingKundli) {\n      try { inputRef.current?.focus(); } catch (e) {}\n    }\n  }, [isOpen, isBotTyping, isGeneratingKundli]);\n\n  // NLP helpers for stepwise extraction\n  const parseName = (text) => {\n    const input = text.trim();\n    const cleanup = (raw) => {\n      if (!raw) return null;\n      // Remove trailing Hindi copula words like 'hai', 'hun', 'hu'\n      let name = raw.replace(/\\b(hai|hun|hu|hoon)\\b\\.?$/i, '').trim();\n      // Remove trailing punctuation\n      name = name.replace(/[.,;:!?]+$/g, '').trim();\n      // Collapse multiple spaces\n      name = name.replace(/\\s{2,}/g, ' ');\n      return name || null;\n    };\n\n    // 1) \"mera naam <name> hai\" (common Hindi pattern)\n    let m = input.match(/(?:^|\\b)mera\\s+naam\\s+([a-zA-Z][a-zA-Z\\s'.-]*?)(?:\\s+(?:hai|hun|hu|hoon))?\\b/i);\n    if (m) return cleanup(m[1]);\n\n    // 2) \"my name is <name>\"\n    m = input.match(/(?:^|\\b)my\\s+name\\s+is\\s+([a-zA-Z][a-zA-Z\\s'.-]+)$/i);\n    if (m) return cleanup(m[1]);\n\n    // 3) \"I am <name>\" or \"I'm <name>\"\n    m = input.match(/^(?:i\\s*am|i'm)\\s+([a-zA-Z][a-zA-Z\\s'.-]+)$/i);\n    if (m) return cleanup(m[1]);\n\n    // 4) Bare name fallback (single or multi-word letters only)\n    m = input.match(/^([a-zA-Z][a-zA-Z\\s'.-]{1,})$/);\n    if (m) return cleanup(m[1]);\n\n    return null;\n  };\n\n  const parseDob = (text) => {\n    const monthNames = ['january','february','march','april','may','june','july','august','september','october','november','december'];\n    const monthShort = ['jan','feb','mar','apr','may','jun','jul','aug','sep','oct','nov','dec'];\n    let m;\n    m = text.match(/(\\d{4})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{1,2})/); // YYYY-MM-DD\n    if (m) return `${m[1]}-${m[2].padStart(2,'0')}-${m[3].padStart(2,'0')}`;\n    m = text.match(/(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{4})/); // DD-MM-YYYY or MM-DD-YYYY\n    if (m) {\n      const a = parseInt(m[1],10), b = parseInt(m[2],10);\n      // Heuristic: if both <=12, assume DD-MM-YYYY by default\n      const day = a; const month = b;\n      return `${m[3]}-${month.toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;\n    }\n    m = text.match(/(\\d{1,2})\\s+(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\\s+(\\d{4})/i);\n    if (m) {\n      const month = monthNames.indexOf(m[2].toLowerCase()) !== -1 \n        ? monthNames.indexOf(m[2].toLowerCase()) + 1\n        : monthShort.indexOf(m[2].toLowerCase()) + 1;\n      return `${m[3]}-${month.toString().padStart(2,'0')}-${m[1].padStart(2,'0')}`;\n    }\n    return null;\n  };\n\n  const parseTob = (text) => {\n    let m = text.match(/(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(am|pm)?/i);\n    if (!m) m = text.match(/(\\d{1,2})[\\.\\s](\\d{2})\\s*(am|pm)?/i);\n    if (m) {\n      let hour = parseInt(m[1],10);\n      const minute = m[2];\n      const sec = m[3] || '00';\n      const period = (m[4] || m[3]) || '';\n      if (/pm/i.test(period) && hour !== 12) hour += 12;\n      if (/am/i.test(period) && hour === 12) hour = 0;\n      if (hour >= 0 && hour <= 23) return `${hour.toString().padStart(2,'0')}:${minute}:${sec}`;\n    }\n    return null;\n  };\n\n  const parsePlace = (text) => {\n    const m = text.match(/(?:place|sthan|city|town|birth\\s*place|janm\\s*sthan|from|in)\\s*:?\\s*([a-zA-Z][a-zA-Z\\s,.'-]+)/i);\n    if (m) return m[1].trim();\n    // Fallback: single word or two words capitalized\n    const m2 = text.match(/^[a-zA-Z][a-zA-Z\\s'.-]{2,}$/);\n    if (m2) return m2[0].trim();\n    return null;\n  };\n\n  const isValidDate = (yyyyMmDd) => {\n    if (!yyyyMmDd) return false;\n    const m = yyyyMmDd.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (!m) return false;\n    const d = new Date(`${m[1]}-${m[2]}-${m[3]}T00:00:00Z`);\n    return !isNaN(d.getTime());\n  };\n\n  const isValidTime = (hhmmss) => /^(\\d{2}):(\\d{2}):(\\d{2})$/.test(hhmmss);\n\n  // Helper function to check if all birth details are collected\n  const isProfileComplete = () => {\n    return userProfile.name && userProfile.dob && userProfile.tob && userProfile.place;\n  };\n\n  // Helper function to generate Kundli and then Chart (sequential flow)\n  // Accepts optional details to avoid relying on possibly stale state\n  const generateKundli = async (detailsOverride) => {\n    if (hasGeneratedRef.current) return; // already generated, skip\n    setIsGeneratingKundli(true);\n    setIsGeneratingChart(true);\n    setCurrentStep('generating');\n    \n    try {\n      const birthDetails = detailsOverride || {\n        name: userProfile.name,\n        dob: userProfile.dob,\n        tob: userProfile.tob,\n        place: userProfile.place,\n        timezone: userProfile.timezone\n      };\n      // 1) Generate Kundli first\n      const kundliResponse = await astroBotAPI.generateKundli(birthDetails);\n\n      if (!kundliResponse.success || !kundliResponse.chart_data) {\n        throw new Error(kundliResponse.error || 'Kundli generation failed');\n      }\n\n      setKundliData(kundliResponse.chart_data);\n\n      // Add Kundli generation success message with warm greeting and remedy promise\n      const successMessage = {\n        id: nextMessageId(),\n        text: `ðŸŽ‰ Bahut badhiya ${userProfile.name} ji! Aapka Kundli taiyar ho gaya hai. Ab main visual chart generate kar raha hun...`,\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages(prev => [...prev, successMessage]);\n\n      // 2) Only after Kundli succeeds, generate Chart\n      const chartResponse = await astroBotAPI.generateChart(birthDetails);\n      if (chartResponse.success && chartResponse.chart_data) {\n        setChartData(chartResponse.chart_data);\n        setIsGeneratingChart(false);\n        setCurrentStep('chart_generated');\n        hasGeneratedRef.current = true;\n        \n        // Optional: confirm chart readiness\n        setMessages(prev => [...prev, {\n          id: nextMessageId(),\n          text: 'ðŸ—ºï¸ Visual chart ready! Aap apne prashn puch sakte hain.',\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        }]);\n      } else {\n        throw new Error(chartResponse.error || 'Chart generation failed');\n      }\n    } catch (error) {\n      console.error('Error generating Kundli:', error);\n      const errorMessage = {\n        id: nextMessageId(),\n        text: \"Sorry, Kundli generate karne mein koi problem aa rahi hai. Kripya dobara try karein ya contact karein.\",\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsGeneratingKundli(false);\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (inputText.trim()) {\n      const newMessage = {\n        id: nextMessageId(),\n        text: inputText,\n        sender: 'user',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      \n      setMessages([...messages, newMessage]);\n      const currentInput = inputText;\n      setInputText('');\n      \n      try {\n        // Show typing indicator\n        const typingMessage = {\n          id: nextMessageId(),\n          text: \"Pandit ji typing...\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString(),\n          isTyping: true\n        };\n        setIsBotTyping(true);\n        setMessages(prev => [...prev, typingMessage]);\n        \n        // Stepwise dialog\n        let botText = '';\n        if (currentStep === 'ask_name') {\n          // allow corrections like: name: Rajesh\n          let name = null;\n          const correction = currentInput.match(/^(?:name|naam)\\s*[:\\-]\\s*(.+)$/i);\n          if (correction) name = correction[1].trim();\n          if (!name) name = parseName(currentInput);\n          if (!name) {\n            botText = \"Kripya apna naam clear tarike se batayiye (e.g., Mera naam Anil hai).\";\n          } else {\n            const updated = { ...userProfile, name };\n            setUserProfile(updated);\n            setCurrentStep('ask_dob');\n            botText = `${name} ji, ab apni janm tithi batayiye (e.g., 15/05/1990 ya 15 May 1990).`;\n          }\n        } else if (currentStep === 'ask_dob') {\n          const dob = parseDob(currentInput);\n          if (!dob || !isValidDate(dob)) {\n            botText = \"Janm tithi samajh nahi aayi. Kripya format mein batayein: DD/MM/YYYY ya 15 May 1990.\";\n          } else {\n            const updated = { ...userProfile, dob };\n            setUserProfile(updated);\n            setCurrentStep('ask_tob');\n            botText = \"Shukriya. Ab apna janm samay batayiye (e.g., 2:30 PM ya 14:30).\";\n          }\n        } else if (currentStep === 'ask_tob') {\n          const tob = parseTob(currentInput);\n          if (!tob || !isValidTime(tob)) {\n            botText = \"Janm samay samajh nahi aaya. Kripya format mein batayein: HH:MM AM/PM ya 24-hour (e.g., 14:30).\";\n          } else {\n            const updated = { ...userProfile, tob };\n            setUserProfile(updated);\n            setCurrentStep('ask_place');\n            botText = \"Samay mil gaya. Ab apna janm sthan/city batayiye (e.g., Delhi, Mumbai).\";\n          }\n        } else if (currentStep === 'ask_place') {\n          const place = parsePlace(currentInput);\n          if (!place) {\n            botText = \"Janm sthan samajh nahi aaya. Kripya city ka naam batayein (e.g., Pune).\";\n          } else {\n            const updated = { ...userProfile, place };\n            setUserProfile(updated);\n            setCurrentStep('confirm_details');\n            botText = `Kripya confirm karein:\\n- Naam: ${updated.name}\\n- DOB: ${updated.dob}\\n- TOB: ${updated.tob}\\n- Place: ${updated.place}\\nType karein: 'yes' ya jis field ko change karna ho: 'change name: <naya naam>'`;\n          }\n        } else if (currentStep === 'confirm_details') {\n          if (/^y(es)?$/i.test(currentInput.trim())) {\n            botText = \"Bahut badiya! Main aapka Kundli chart generate kar raha hun...\";\n            setCurrentStep('generating');\n            // proceed without removing typing bubble\n        setMessages(prev => prev.filter(msg => !msg.isTyping).concat({\n          id: nextMessageId(),\n              text: botText,\n              sender: 'pandit',\n              timestamp: new Date().toLocaleTimeString()\n            }));\n            const details = {\n              name: userProfile.name,\n              dob: userProfile.dob,\n              tob: userProfile.tob,\n              place: userProfile.place,\n              timezone: userProfile.timezone\n            };\n            // Small buffer to ensure any last state changes settle\n            await new Promise(res => setTimeout(res, 150));\n            await generateKundli(details);\n            return;\n          }\n          const change = currentInput.match(/^change\\s+(name|naam|dob|date|tob|time|samay|place|city|sthan)\\s*[:\\-]\\s*(.+)$/i);\n          if (change) {\n            const field = change[1].toLowerCase();\n            const value = change[2].trim();\n            const updated = { ...userProfile };\n            if (field === 'name' || field === 'naam') updated.name = value;\n            else if (field === 'dob' || field === 'date') {\n              const dob = parseDob(value);\n              if (dob && isValidDate(dob)) updated.dob = dob; else {\n                botText = \"Nayi DOB valid nahi hai. Example: 15/05/1990\";\n              }\n            } else if (field === 'tob' || field === 'time' || field === 'samay') {\n              const tob = parseTob(value);\n              if (tob && isValidTime(tob)) updated.tob = tob; else {\n                botText = \"Naya TOB valid nahi hai. Example: 2:30 PM ya 14:30\";\n              }\n            } else if (field === 'place' || field === 'city' || field === 'sthan') {\n              const place = parsePlace(value);\n              if (place) updated.place = place; else {\n                botText = \"Naya place samajh nahi aaya. Example: Jaipur\";\n              }\n            }\n            setUserProfile(updated);\n            if (!botText) {\n              botText = `Updated. Kripya confirm karein:\\n- Naam: ${updated.name}\\n- DOB: ${updated.dob}\\n- TOB: ${updated.tob}\\n- Place: ${updated.place}\\nType 'yes' ya 'change <field>: <value>'`;\n            }\n          } else {\n            botText = \"Kripya 'yes' type karein ya 'change <field>: <value>' batayein (e.g., change dob: 1990-05-15).\";\n          }\n        } else if (currentStep === 'chart_generated' || currentStep === 'chatting') {\n          // Regular chat with chart context; prefer Kundli data (has name and rich context)\n          const chartContext = kundliData || chartData || null;\n          const response = await astroBotAPI.sendChatMessage(currentInput, chartContext);\n          botText = response.response;\n          setCurrentStep('chatting');\n        } else if (currentStep === 'generating') {\n          botText = \"Chart generate ho raha hai, kripya wait karein...\";\n        }\n\n        // Smooth typing simulation with thoughtful delay for predictions (8-10 seconds)\n        const looksLikePrediction = /\\b(yog|shaadi|career|health|mangal|grah|kundli|prediction|yoga|marriage|job|business|future)\\b/i.test(botText || '');\n        const baseDelay = looksLikePrediction ? 8000 : 1200; // 8s+ for predictions, 1.2s for regular chat\n        const variableDelay = looksLikePrediction ? Math.min(2000, Math.floor((botText?.length || 0) / 15) * 80) : 500;\n        const delayMs = baseDelay + variableDelay; // Total 8-10 seconds for predictions\n        await new Promise(res => setTimeout(res, delayMs));\n        // Remove typing indicator and add botText\n        setMessages(prev => {\n          const withoutTyping = prev.filter(msg => !msg.isTyping);\n          return [...withoutTyping, {\n            id: nextMessageId(),\n            text: botText,\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          }];\n        });\n        // Optionally add a gentle follow-up question to keep flow natural\n        if (currentStep === 'chatting' || currentStep === 'chart_generated') {\n          const followUps = [\n            \"Abhi aapke rishte ki baat chal rahi hai kya?\",\n            \"Kya aap kisi ko pasand karte ho?\",\n            \"Aapka career kis field mein hai?\",\n            \"Aapko apni health ke baare mein bhi jaana hai kya?\"\n          ];\n          const fupDelay = 1200 + Math.floor(Math.random() * 1200);\n          setTimeout(() => {\n            setMessages(prev => ([...prev, {\n              id: nextMessageId(),\n              text: followUps[Math.floor(Math.random() * followUps.length)],\n              sender: 'pandit',\n              timestamp: new Date().toLocaleTimeString()\n            }]));\n          }, fupDelay);\n        }\n        setIsBotTyping(false);\n        \n      } catch (error) {\n        console.error('Error sending message:', error);\n        \n        // Remove typing indicator and show error\n        setMessages(prev => {\n          const withoutTyping = prev.filter(msg => !msg.isTyping);\n          const errorResponse = {\n            id: nextMessageId(),\n            text: \"Sorry, main abhi online nahi hun. Kripya thoda baad try karein.\",\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          };\n          return [...withoutTyping, errorResponse];\n        });\n        setIsBotTyping(false);\n      }\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      handleSendMessage();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className={`expandable-chat-container ${isOpen ? 'expanded' : ''}`}>\n      {/* Chat Header */}\n      <div className=\"chat-header\">\n        <div className=\"pandit-info\">\n          <div className=\"pandit-avatar-small\">\n            <img src={require('../assets/Astro_Avatar.png')} alt=\"Pandit ji\" />\n          </div>\n          <div className=\"pandit-details\">\n            <h3>Pandit ji</h3>\n            <span className=\"status\">Online</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Messages Area */}\n      <div className=\"messages-container\">\n        {messages.map((message) => (\n          <div key={message.id} className={`message ${message.sender}`}>\n            {message.sender === 'pandit' && (\n              <div className=\"message-avatar\">\n                <img src={require('../assets/Astro_Avatar.png')} alt=\"Pandit ji\" />\n              </div>\n            )}\n            <div className=\"message-content\">\n              <div className=\"message-bubble\">\n                <p>{message.text}</p>\n                <span className=\"message-time\">{message.timestamp}</span>\n              </div>\n            </div>\n          </div>\n        ))}\n        <div ref={messagesEndRef} />\n        \n        {/* Kundli Chart Display */}\n        {chartData && (\n          <KundliChart \n            chartData={chartData} \n            onChartReady={() => {\n              // Chart is ready, no need for additional message\n              console.log('Chart loaded successfully');\n            }}\n          />\n        )}\n        \n        {/* Loading indicator for Kundli generation */}\n        {(isGeneratingKundli || isGeneratingChart) && (\n          <div className=\"kundli-loading\">\n            <div className=\"loading-spinner\"></div>\n            <p>ðŸ”® Aapka Kundli chart generate ho raha hai... Kripya wait karein</p>\n          </div>\n        )}\n      </div>\n\n      {/* Input Area */}\n      <div className=\"input-container\">\n        <div className=\"input-wrapper\">\n          <input\n            type=\"text\"\n            value={inputText}\n            onChange={(e) => setInputText(e.target.value)}\n            onKeyPress={handleKeyPress}\n            ref={inputRef}\n            placeholder={\n              currentStep === 'greeting' || currentStep === 'collecting_details'\n                ? \"Format: naam, DD/MM/YYYY, HH:MM, place (e.g., Rajesh, 15/05/1990, 14:30, Delhi)\"\n                : \"Apna sawal yahan likhein...\"\n            }\n            className=\"message-input\"\n            disabled={isGeneratingKundli || isBotTyping}\n          />\n          <button \n            onClick={handleSendMessage} \n            className=\"send-button\"\n            disabled={isGeneratingKundli || isBotTyping}\n          >\n            <svg viewBox=\"0 0 24 24\" className=\"send-icon\">\n              <path d=\"M22 2L11 13\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n              <path d=\"M22 2L15 22L11 13L2 9L22 2Z\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            </svg>\n          </button>\n          {(currentStep === 'confirm_details' || currentStep === 'chart_generated' || currentStep === 'chatting') && (\n            <button\n              onClick={() => {\n                setEditMode((prev) => !prev);\n                if (!editMode) {\n                  // entering edit mode: show current details\n                  const m = {\n                    id: nextMessageId(),\n                    text: `Edit mode enabled. Type: change name: <value> / change dob: <value> / change tob: <value> / change place: <value>. Then type 'save' to confirm.`,\n                    sender: 'pandit',\n                    timestamp: new Date().toLocaleTimeString()\n                  };\n                  setMessages((prev) => [...prev, m]);\n                }\n              }}\n              className=\"send-button\"\n              style={{ marginLeft: 8 }}\n            >\n              {editMode ? 'Done' : 'Edit details'}\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ExpandableChat;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
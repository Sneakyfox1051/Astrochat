{"ast":null,"code":"var _jsxFileName = \"D:\\\\Downloads\\\\astro-main\\\\frontend\\\\src\\\\components\\\\ExpandableChat.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport './ExpandableChat.css';\nimport astroBotAPI from '../services/api';\nimport KundliChart from './KundliChart';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ExpandableChat = ({\n  isOpen,\n  onClose,\n  onRefresh,\n  userData\n}) => {\n  _s();\n  const [messages, setMessages] = useState([{\n    id: 1,\n    text: \"Jai Shri Ram 🙏 Swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon.\",\n    sender: 'pandit',\n    timestamp: new Date().toLocaleTimeString()\n  }, {\n    id: 2,\n    text: \"Aapka naam kya hai aur kis vishay par margdarshan chahte hain? Pehle apna naam batayiye (e.g., Mera naam Rajesh hai).\",\n    sender: 'pandit',\n    timestamp: new Date().toLocaleTimeString()\n  }]);\n  const [inputText, setInputText] = useState('');\n  const [userProfile, setUserProfile] = useState({\n    name: '',\n    dob: '',\n    tob: '',\n    place: '',\n    timezone: 'Asia/Kolkata'\n  });\n  const [kundliData, setKundliData] = useState(null);\n  const [chartData, setChartData] = useState(null);\n  const [isGeneratingKundli, setIsGeneratingKundli] = useState(false);\n  const [isGeneratingChart, setIsGeneratingChart] = useState(false);\n  // Steps: ask_name, ask_dob, ask_tob, ask_place, confirm_details, generating, chart_generated, chatting\n  const [currentStep, setCurrentStep] = useState('ask_name');\n  const messagesEndRef = React.useRef(null);\n  const inputRef = React.useRef(null);\n  const [editMode, setEditMode] = useState(false);\n  const messageIdRef = React.useRef(3);\n  const [isBotTyping, setIsBotTyping] = useState(false);\n  const nextMessageId = () => {\n    const id = messageIdRef.current;\n    messageIdRef.current += 1;\n    return id;\n  };\n\n  // Handle userData from form - skip data collection and generate Kundli directly\n  React.useEffect(() => {\n    if (userData && isOpen) {\n      // Set user profile from form data\n      setUserProfile({\n        name: userData.name,\n        dob: userData.dob,\n        tob: userData.tob,\n        place: userData.place,\n        timezone: userData.timezone\n      });\n\n      // Update messages to show welcome with user's name and start Kundli generation\n      setMessages([{\n        id: 1,\n        text: `Jai Shri Ram 🙏 Swagat hai aapka AstroRemedis par, ${userData.name} ji! Main aapka digital Pandit Ji hoon.`,\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      }, {\n        id: 2,\n        text: `Aapka Kundli chart generate kar raha hun... Kripya thoda wait karein.`,\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      }]);\n\n      // Set step to generating and start Kundli generation\n      setCurrentStep('generating');\n      generateKundliWithUserData(userData);\n    }\n  }, [userData, isOpen]);\n\n  // Handle refresh - clear messages and reset to initial state\n  React.useEffect(() => {\n    if (onRefresh) {\n      const resetMessages = () => {\n        setMessages([{\n          id: 1,\n          text: \"Jai Shri Ram 🙏 Swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon.\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        }, {\n          id: 2,\n          text: \"Aapka naam kya hai aur kis vishay par margdarshan chahte hain? Pehle apna naam batayiye (e.g., Mera naam Rajesh hai).\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        }]);\n        setInputText('');\n        setUserProfile({\n          name: '',\n          dob: '',\n          tob: '',\n          place: '',\n          timezone: 'Asia/Kolkata'\n        });\n        setKundliData(null);\n        setChartData(null);\n        setCurrentStep('ask_name');\n        setEditMode(false);\n      };\n\n      // Listen for refresh events\n      const handleRefresh = () => {\n        resetMessages();\n      };\n\n      // Store the handler so we can clean it up\n      window.addEventListener('refreshChat', handleRefresh);\n      return () => {\n        window.removeEventListener('refreshChat', handleRefresh);\n      };\n    }\n  }, [onRefresh]);\n\n  // Auto-scroll to latest message\n  React.useEffect(() => {\n    try {\n      var _messagesEndRef$curre;\n      (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n        behavior: 'smooth'\n      });\n    } catch (e) {\n      // ignore scroll errors\n    }\n  }, [messages, isGeneratingKundli, isGeneratingChart, chartData]);\n\n  // Auto-focus input when chat opens or bot finished typing\n  React.useEffect(() => {\n    if (isOpen && !isBotTyping && !isGeneratingKundli) {\n      try {\n        var _inputRef$current;\n        (_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.focus();\n      } catch (e) {}\n    }\n  }, [isOpen, isBotTyping, isGeneratingKundli]);\n\n  // NLP helpers for stepwise extraction\n  const parseName = text => {\n    const input = text.trim();\n    const cleanup = raw => {\n      if (!raw) return null;\n      // Remove trailing Hindi copula words like 'hai', 'hun', 'hu'\n      let name = raw.replace(/\\b(hai|hun|hu|hoon)\\b\\.?$/i, '').trim();\n      // Remove trailing punctuation\n      name = name.replace(/[.,;:!?]+$/g, '').trim();\n      // Collapse multiple spaces\n      name = name.replace(/\\s{2,}/g, ' ');\n      return name || null;\n    };\n\n    // 1) \"mera naam <name> hai\" (common Hindi pattern)\n    let m = input.match(/(?:^|\\b)mera\\s+naam\\s+([a-zA-Z][a-zA-Z\\s'.-]*?)(?:\\s+(?:hai|hun|hu|hoon))?\\b/i);\n    if (m) return cleanup(m[1]);\n\n    // 2) \"my name is <name>\"\n    m = input.match(/(?:^|\\b)my\\s+name\\s+is\\s+([a-zA-Z][a-zA-Z\\s'.-]+)$/i);\n    if (m) return cleanup(m[1]);\n\n    // 3) \"I am <name>\" or \"I'm <name>\"\n    m = input.match(/^(?:i\\s*am|i'm)\\s+([a-zA-Z][a-zA-Z\\s'.-]+)$/i);\n    if (m) return cleanup(m[1]);\n\n    // 4) Bare name fallback (single or multi-word letters only)\n    m = input.match(/^([a-zA-Z][a-zA-Z\\s'.-]{1,})$/);\n    if (m) return cleanup(m[1]);\n    return null;\n  };\n  const parseDob = text => {\n    const monthNames = ['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'];\n    const monthShort = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];\n    let m;\n    m = text.match(/(\\d{4})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{1,2})/); // YYYY-MM-DD\n    if (m) return `${m[1]}-${m[2].padStart(2, '0')}-${m[3].padStart(2, '0')}`;\n    m = text.match(/(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{4})/); // DD-MM-YYYY or MM-DD-YYYY\n    if (m) {\n      const a = parseInt(m[1], 10),\n        b = parseInt(m[2], 10);\n      // Heuristic: if both <=12, assume DD-MM-YYYY by default\n      const day = a;\n      const month = b;\n      return `${m[3]}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;\n    }\n    m = text.match(/(\\d{1,2})\\s+(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\\s+(\\d{4})/i);\n    if (m) {\n      const month = monthNames.indexOf(m[2].toLowerCase()) !== -1 ? monthNames.indexOf(m[2].toLowerCase()) + 1 : monthShort.indexOf(m[2].toLowerCase()) + 1;\n      return `${m[3]}-${month.toString().padStart(2, '0')}-${m[1].padStart(2, '0')}`;\n    }\n    return null;\n  };\n  const parseTob = text => {\n    let m = text.match(/(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(am|pm)?/i);\n    if (!m) m = text.match(/(\\d{1,2})[\\.\\s](\\d{2})\\s*(am|pm)?/i);\n    if (m) {\n      let hour = parseInt(m[1], 10);\n      const minute = m[2];\n      const sec = m[3] || '00';\n      const period = m[4] || m[3] || '';\n      if (/pm/i.test(period) && hour !== 12) hour += 12;\n      if (/am/i.test(period) && hour === 12) hour = 0;\n      if (hour >= 0 && hour <= 23) return `${hour.toString().padStart(2, '0')}:${minute}:${sec}`;\n    }\n    return null;\n  };\n  const parsePlace = text => {\n    const m = text.match(/(?:place|sthan|city|town|birth\\s*place|janm\\s*sthan|from|in)\\s*:?\\s*([a-zA-Z][a-zA-Z\\s,.'-]+)/i);\n    if (m) return m[1].trim();\n    // Fallback: single word or two words capitalized\n    const m2 = text.match(/^[a-zA-Z][a-zA-Z\\s'.-]{2,}$/);\n    if (m2) return m2[0].trim();\n    return null;\n  };\n  const isValidDate = yyyyMmDd => {\n    if (!yyyyMmDd) return false;\n    const m = yyyyMmDd.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (!m) return false;\n    const d = new Date(`${m[1]}-${m[2]}-${m[3]}T00:00:00Z`);\n    return !isNaN(d.getTime());\n  };\n  const isValidTime = hhmmss => /^(\\d{2}):(\\d{2}):(\\d{2})$/.test(hhmmss);\n\n  // Helper function to check if all birth details are collected\n  const isProfileComplete = () => {\n    return userProfile.name && userProfile.dob && userProfile.tob && userProfile.place;\n  };\n\n  // Helper function to generate Kundli and Chart\n  const generateKundli = async () => {\n    setIsGeneratingKundli(true);\n    setIsGeneratingChart(true);\n    setCurrentStep('generating');\n    try {\n      const birthDetails = {\n        name: userProfile.name,\n        dob: userProfile.dob,\n        tob: userProfile.tob,\n        place: userProfile.place,\n        timezone: userProfile.timezone\n      };\n\n      // Generate both chart and kundli data in parallel\n      const [chartResponse, kundliResponse] = await Promise.all([astroBotAPI.generateChart(birthDetails), astroBotAPI.generateKundli(birthDetails)]);\n      if (chartResponse.success && chartResponse.chart_data) {\n        setChartData(chartResponse.chart_data);\n        setIsGeneratingChart(false);\n      }\n      if (kundliResponse.success && kundliResponse.chart_data) {\n        setKundliData(kundliResponse.chart_data);\n        setCurrentStep('chart_generated');\n\n        // Add Kundli generation success message\n        const successMessage = {\n          id: nextMessageId(),\n          text: `🎉 ${userProfile.name} ji, aapka Kundli chart taiyar hai! Ab aap koi bhi sawal puch sakte hain - grah ki sthiti, dasha, yog, ya koi bhi astrological prediction ke bare mein.`,\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        };\n        setMessages(prev => [...prev, successMessage]);\n      } else {\n        throw new Error(kundliResponse.error || 'Kundli generation failed');\n      }\n    } catch (error) {\n      console.error('Error generating Kundli:', error);\n      const errorMessage = {\n        id: nextMessageId(),\n        text: \"Sorry, Kundli generate karne mein koi problem aa rahi hai. Kripya dobara try karein ya contact karein.\",\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsGeneratingKundli(false);\n    }\n  };\n\n  // Helper function to generate Kundli with user data from form\n  const generateKundliWithUserData = async data => {\n    setIsGeneratingKundli(true);\n    setIsGeneratingChart(true);\n    try {\n      // Generate both chart and kundli data in parallel\n      const [chartResponse, kundliResponse] = await Promise.all([astroBotAPI.generateChart(data), astroBotAPI.generateKundli(data)]);\n      if (chartResponse.success && chartResponse.chart_data) {\n        setChartData(chartResponse.chart_data);\n        setIsGeneratingChart(false);\n      }\n      if (kundliResponse.success && kundliResponse.chart_data) {\n        setKundliData(kundliResponse.chart_data);\n        setCurrentStep('chart_generated');\n\n        // Add Kundli generation success message\n        const successMessage = {\n          id: nextMessageId(),\n          text: `🎉 ${data.name} ji, aapka Kundli chart taiyar hai! Ab aap koi bhi sawal puch sakte hain - grah ki sthiti, dasha, yog, ya koi bhi astrological prediction ke bare mein.`,\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        };\n        setMessages(prev => [...prev, successMessage]);\n      } else {\n        throw new Error(kundliResponse.error || 'Kundli generation failed');\n      }\n    } catch (error) {\n      console.error('Error generating Kundli:', error);\n      const errorMessage = {\n        id: nextMessageId(),\n        text: \"Sorry, Kundli generate karne mein koi problem aa rahi hai. Kripya dobara try karein ya contact karein.\",\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsGeneratingKundli(false);\n    }\n  };\n  const handleSendMessage = async () => {\n    if (inputText.trim()) {\n      const newMessage = {\n        id: nextMessageId(),\n        text: inputText,\n        sender: 'user',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages([...messages, newMessage]);\n      const currentInput = inputText;\n      setInputText('');\n      try {\n        var _botText;\n        // Show typing indicator\n        const typingMessage = {\n          id: nextMessageId(),\n          text: \"Pandit ji typing...\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString(),\n          isTyping: true\n        };\n        setIsBotTyping(true);\n        setMessages(prev => [...prev, typingMessage]);\n\n        // Stepwise dialog\n        let botText = '';\n        if (currentStep === 'ask_name') {\n          // allow corrections like: name: Rajesh\n          let name = null;\n          const correction = currentInput.match(/^(?:name|naam)\\s*[:\\-]\\s*(.+)$/i);\n          if (correction) name = correction[1].trim();\n          if (!name) name = parseName(currentInput);\n          if (!name) {\n            botText = \"Kripya apna naam clear tarike se batayiye (e.g., Mera naam Anil hai).\";\n          } else {\n            const updated = {\n              ...userProfile,\n              name\n            };\n            setUserProfile(updated);\n            setCurrentStep('ask_dob');\n            botText = `${name} ji, ab apni janm tithi batayiye (e.g., 15/05/1990 ya 15 May 1990).`;\n          }\n        } else if (currentStep === 'ask_dob') {\n          const dob = parseDob(currentInput);\n          if (!dob || !isValidDate(dob)) {\n            botText = \"Janm tithi samajh nahi aayi. Kripya format mein batayein: DD/MM/YYYY ya 15 May 1990.\";\n          } else {\n            const updated = {\n              ...userProfile,\n              dob\n            };\n            setUserProfile(updated);\n            setCurrentStep('ask_tob');\n            botText = \"Shukriya. Ab apna janm samay batayiye (e.g., 2:30 PM ya 14:30).\";\n          }\n        } else if (currentStep === 'ask_tob') {\n          const tob = parseTob(currentInput);\n          if (!tob || !isValidTime(tob)) {\n            botText = \"Janm samay samajh nahi aaya. Kripya format mein batayein: HH:MM AM/PM ya 24-hour (e.g., 14:30).\";\n          } else {\n            const updated = {\n              ...userProfile,\n              tob\n            };\n            setUserProfile(updated);\n            setCurrentStep('ask_place');\n            botText = \"Samay mil gaya. Ab apna janm sthan/city batayiye (e.g., Delhi, Mumbai).\";\n          }\n        } else if (currentStep === 'ask_place') {\n          const place = parsePlace(currentInput);\n          if (!place) {\n            botText = \"Janm sthan samajh nahi aaya. Kripya city ka naam batayein (e.g., Pune).\";\n          } else {\n            const updated = {\n              ...userProfile,\n              place\n            };\n            setUserProfile(updated);\n            setCurrentStep('confirm_details');\n            botText = `Kripya confirm karein:\\n- Naam: ${updated.name}\\n- DOB: ${updated.dob}\\n- TOB: ${updated.tob}\\n- Place: ${updated.place}\\nType karein: 'yes' ya jis field ko change karna ho: 'change name: <naya naam>'`;\n          }\n        } else if (currentStep === 'confirm_details') {\n          if (/^y(es)?$/i.test(currentInput.trim())) {\n            botText = \"Bahut badiya! Main aapka Kundli chart generate kar raha hun...\";\n            setCurrentStep('generating');\n            // proceed without removing typing bubble\n            setMessages(prev => prev.filter(msg => !msg.isTyping).concat({\n              id: nextMessageId(),\n              text: botText,\n              sender: 'pandit',\n              timestamp: new Date().toLocaleTimeString()\n            }));\n            await generateKundli();\n            return;\n          }\n          const change = currentInput.match(/^change\\s+(name|naam|dob|date|tob|time|samay|place|city|sthan)\\s*[:\\-]\\s*(.+)$/i);\n          if (change) {\n            const field = change[1].toLowerCase();\n            const value = change[2].trim();\n            const updated = {\n              ...userProfile\n            };\n            if (field === 'name' || field === 'naam') updated.name = value;else if (field === 'dob' || field === 'date') {\n              const dob = parseDob(value);\n              if (dob && isValidDate(dob)) updated.dob = dob;else {\n                botText = \"Nayi DOB valid nahi hai. Example: 15/05/1990\";\n              }\n            } else if (field === 'tob' || field === 'time' || field === 'samay') {\n              const tob = parseTob(value);\n              if (tob && isValidTime(tob)) updated.tob = tob;else {\n                botText = \"Naya TOB valid nahi hai. Example: 2:30 PM ya 14:30\";\n              }\n            } else if (field === 'place' || field === 'city' || field === 'sthan') {\n              const place = parsePlace(value);\n              if (place) updated.place = place;else {\n                botText = \"Naya place samajh nahi aaya. Example: Jaipur\";\n              }\n            }\n            setUserProfile(updated);\n            if (!botText) {\n              botText = `Updated. Kripya confirm karein:\\n- Naam: ${updated.name}\\n- DOB: ${updated.dob}\\n- TOB: ${updated.tob}\\n- Place: ${updated.place}\\nType 'yes' ya 'change <field>: <value>'`;\n            }\n          } else {\n            botText = \"Kripya 'yes' type karein ya 'change <field>: <value>' batayein (e.g., change dob: 1990-05-15).\";\n          }\n        } else if (currentStep === 'chart_generated' || currentStep === 'chatting') {\n          // Regular chat with chart context\n          const response = await astroBotAPI.sendChatMessage(currentInput, chartData);\n          botText = response.response;\n          setCurrentStep('chatting');\n        } else if (currentStep === 'generating') {\n          botText = \"Chart generate ho raha hai, kripya wait karein...\";\n        }\n\n        // Smooth typing simulation with thoughtful delay for predictions\n        const looksLikePrediction = /\\b(yog|shaadi|career|health|mangal|grah|kundli|prediction|yoga)\\b/i.test(botText || '');\n        const baseDelay = looksLikePrediction ? 8000 : 600; // ~8s for predictions, shorter otherwise\n        const variableDelay = Math.min(2000, Math.floor((((_botText = botText) === null || _botText === void 0 ? void 0 : _botText.length) || 0) / 12) * 60);\n        const delayMs = baseDelay + variableDelay;\n        await new Promise(res => setTimeout(res, delayMs));\n        // Remove typing indicator and add botText\n        setMessages(prev => {\n          const withoutTyping = prev.filter(msg => !msg.isTyping);\n          return [...withoutTyping, {\n            id: nextMessageId(),\n            text: botText,\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          }];\n        });\n        // Optionally add a gentle follow-up question to keep flow natural\n        if (currentStep === 'chatting' || currentStep === 'chart_generated') {\n          const followUps = [\"Abhi aapke rishte ki baat chal rahi hai kya?\", \"Kya aap kisi ko pasand karte ho?\", \"Aapka career kis field mein hai?\", \"Aapko apni health ke baare mein bhi jaana hai kya?\"];\n          const fupDelay = 1200 + Math.floor(Math.random() * 1200);\n          setTimeout(() => {\n            setMessages(prev => [...prev, {\n              id: nextMessageId(),\n              text: followUps[Math.floor(Math.random() * followUps.length)],\n              sender: 'pandit',\n              timestamp: new Date().toLocaleTimeString()\n            }]);\n          }, fupDelay);\n        }\n        setIsBotTyping(false);\n      } catch (error) {\n        console.error('Error sending message:', error);\n\n        // Remove typing indicator and show error\n        setMessages(prev => {\n          const withoutTyping = prev.filter(msg => !msg.isTyping);\n          const errorResponse = {\n            id: nextMessageId(),\n            text: \"Sorry, main abhi online nahi hun. Kripya thoda baad try karein.\",\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          };\n          return [...withoutTyping, errorResponse];\n        });\n        setIsBotTyping(false);\n      }\n    }\n  };\n  const handleKeyPress = e => {\n    if (e.key === 'Enter') {\n      handleSendMessage();\n    }\n  };\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `expandable-chat-container ${isOpen ? 'expanded' : ''}`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pandit-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pandit-avatar-small\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: require('../assets/Astro_Avatar.png'),\n            alt: \"Pandit ji\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 531,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 530,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pandit-details\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Pandit ji\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 534,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"status\",\n            children: \"Online\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 535,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 533,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 529,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 528,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages-container\",\n      children: [messages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `message ${message.sender}`,\n        children: [message.sender === 'pandit' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-avatar\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: require('../assets/Astro_Avatar.png'),\n            alt: \"Pandit ji\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 546,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-content\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-bubble\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: message.text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 551,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"message-time\",\n              children: message.timestamp\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 552,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 550,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 549,\n          columnNumber: 13\n        }, this)]\n      }, message.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 543,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 557,\n        columnNumber: 9\n      }, this), chartData && /*#__PURE__*/_jsxDEV(KundliChart, {\n        chartData: chartData,\n        onChartReady: () => {\n          // Chart is ready, no need for additional message\n          console.log('Chart loaded successfully');\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 561,\n        columnNumber: 11\n      }, this), (isGeneratingKundli || isGeneratingChart) && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"kundli-loading\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading-spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 573,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\uD83D\\uDD2E Aapka Kundli chart generate ho raha hai... Kripya wait karein\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 574,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 572,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 541,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"input-container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"input-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: inputText,\n          onChange: e => setInputText(e.target.value),\n          onKeyPress: handleKeyPress,\n          ref: inputRef,\n          placeholder: currentStep === 'greeting' || currentStep === 'collecting_details' ? \"Format: naam, DD/MM/YYYY, HH:MM, place (e.g., Rajesh, 15/05/1990, 14:30, Delhi)\" : \"Apna sawal yahan likhein...\",\n          className: \"message-input\",\n          disabled: isGeneratingKundli || isBotTyping\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 582,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSendMessage,\n          className: \"send-button\",\n          disabled: isGeneratingKundli || isBotTyping,\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            viewBox: \"0 0 24 24\",\n            className: \"send-icon\",\n            children: [/*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M22 2L11 13\",\n              stroke: \"currentColor\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 602,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M22 2L15 22L11 13L2 9L22 2Z\",\n              stroke: \"currentColor\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 603,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 601,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 596,\n          columnNumber: 11\n        }, this), (currentStep === 'confirm_details' || currentStep === 'chart_generated' || currentStep === 'chatting') && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            setEditMode(prev => !prev);\n            if (!editMode) {\n              // entering edit mode: show current details\n              const m = {\n                id: nextMessageId(),\n                text: `Edit mode enabled. Type: change name: <value> / change dob: <value> / change tob: <value> / change place: <value>. Then type 'save' to confirm.`,\n                sender: 'pandit',\n                timestamp: new Date().toLocaleTimeString()\n              };\n              setMessages(prev => [...prev, m]);\n            }\n          },\n          className: \"send-button\",\n          style: {\n            marginLeft: 8\n          },\n          children: editMode ? 'Done' : 'Edit details'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 581,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 580,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 526,\n    columnNumber: 5\n  }, this);\n};\n_s(ExpandableChat, \"0mlve5ZKbvTxQBfaiHtLEqde06w=\");\n_c = ExpandableChat;\nexport default ExpandableChat;\nvar _c;\n$RefreshReg$(_c, \"ExpandableChat\");","map":{"version":3,"names":["React","useState","astroBotAPI","KundliChart","jsxDEV","_jsxDEV","ExpandableChat","isOpen","onClose","onRefresh","userData","_s","messages","setMessages","id","text","sender","timestamp","Date","toLocaleTimeString","inputText","setInputText","userProfile","setUserProfile","name","dob","tob","place","timezone","kundliData","setKundliData","chartData","setChartData","isGeneratingKundli","setIsGeneratingKundli","isGeneratingChart","setIsGeneratingChart","currentStep","setCurrentStep","messagesEndRef","useRef","inputRef","editMode","setEditMode","messageIdRef","isBotTyping","setIsBotTyping","nextMessageId","current","useEffect","generateKundliWithUserData","resetMessages","handleRefresh","window","addEventListener","removeEventListener","_messagesEndRef$curre","scrollIntoView","behavior","e","_inputRef$current","focus","parseName","input","trim","cleanup","raw","replace","m","match","parseDob","monthNames","monthShort","padStart","a","parseInt","b","day","month","toString","indexOf","toLowerCase","parseTob","hour","minute","sec","period","test","parsePlace","m2","isValidDate","yyyyMmDd","d","isNaN","getTime","isValidTime","hhmmss","isProfileComplete","generateKundli","birthDetails","chartResponse","kundliResponse","Promise","all","generateChart","success","chart_data","successMessage","prev","Error","error","console","errorMessage","data","handleSendMessage","newMessage","currentInput","_botText","typingMessage","isTyping","botText","correction","updated","filter","msg","concat","change","field","value","response","sendChatMessage","looksLikePrediction","baseDelay","variableDelay","Math","min","floor","length","delayMs","res","setTimeout","withoutTyping","followUps","fupDelay","random","errorResponse","handleKeyPress","key","className","children","src","require","alt","fileName","_jsxFileName","lineNumber","columnNumber","map","message","ref","onChartReady","log","type","onChange","target","onKeyPress","placeholder","disabled","onClick","viewBox","stroke","strokeWidth","strokeLinecap","strokeLinejoin","style","marginLeft","_c","$RefreshReg$"],"sources":["D:/Downloads/astro-main/frontend/src/components/ExpandableChat.js"],"sourcesContent":["import React, { useState } from 'react';\nimport './ExpandableChat.css';\nimport astroBotAPI from '../services/api';\nimport KundliChart from './KundliChart';\n\nconst ExpandableChat = ({ isOpen, onClose, onRefresh, userData }) => {\n  const [messages, setMessages] = useState([\n    {\n      id: 1,\n      text: \"Jai Shri Ram 🙏 Swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon.\",\n      sender: 'pandit',\n      timestamp: new Date().toLocaleTimeString()\n    },\n    {\n      id: 2,\n      text: \"Aapka naam kya hai aur kis vishay par margdarshan chahte hain? Pehle apna naam batayiye (e.g., Mera naam Rajesh hai).\",\n      sender: 'pandit',\n      timestamp: new Date().toLocaleTimeString()\n    }\n  ]);\n  const [inputText, setInputText] = useState('');\n  const [userProfile, setUserProfile] = useState({\n    name: '',\n    dob: '',\n    tob: '',\n    place: '',\n    timezone: 'Asia/Kolkata'\n  });\n  const [kundliData, setKundliData] = useState(null);\n  const [chartData, setChartData] = useState(null);\n  const [isGeneratingKundli, setIsGeneratingKundli] = useState(false);\n  const [isGeneratingChart, setIsGeneratingChart] = useState(false);\n  // Steps: ask_name, ask_dob, ask_tob, ask_place, confirm_details, generating, chart_generated, chatting\n  const [currentStep, setCurrentStep] = useState('ask_name');\n  const messagesEndRef = React.useRef(null);\n  const inputRef = React.useRef(null);\n  const [editMode, setEditMode] = useState(false);\n  const messageIdRef = React.useRef(3);\n  const [isBotTyping, setIsBotTyping] = useState(false);\n\n  const nextMessageId = () => {\n    const id = messageIdRef.current;\n    messageIdRef.current += 1;\n    return id;\n  };\n\n  // Handle userData from form - skip data collection and generate Kundli directly\n  React.useEffect(() => {\n    if (userData && isOpen) {\n      // Set user profile from form data\n      setUserProfile({\n        name: userData.name,\n        dob: userData.dob,\n        tob: userData.tob,\n        place: userData.place,\n        timezone: userData.timezone\n      });\n      \n      // Update messages to show welcome with user's name and start Kundli generation\n      setMessages([\n        {\n          id: 1,\n          text: `Jai Shri Ram 🙏 Swagat hai aapka AstroRemedis par, ${userData.name} ji! Main aapka digital Pandit Ji hoon.`,\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        },\n        {\n          id: 2,\n          text: `Aapka Kundli chart generate kar raha hun... Kripya thoda wait karein.`,\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        }\n      ]);\n      \n      // Set step to generating and start Kundli generation\n      setCurrentStep('generating');\n      generateKundliWithUserData(userData);\n    }\n  }, [userData, isOpen]);\n\n  // Handle refresh - clear messages and reset to initial state\n  React.useEffect(() => {\n    if (onRefresh) {\n      const resetMessages = () => {\n        setMessages([\n          {\n            id: 1,\n            text: \"Jai Shri Ram 🙏 Swagat hai aapka AstroRemedis par. Main aapka digital Pandit Ji hoon.\",\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          },\n          {\n            id: 2,\n            text: \"Aapka naam kya hai aur kis vishay par margdarshan chahte hain? Pehle apna naam batayiye (e.g., Mera naam Rajesh hai).\",\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          }\n        ]);\n        setInputText('');\n        setUserProfile({\n          name: '',\n          dob: '',\n          tob: '',\n          place: '',\n          timezone: 'Asia/Kolkata'\n        });\n        setKundliData(null);\n        setChartData(null);\n        setCurrentStep('ask_name');\n        setEditMode(false);\n      };\n      \n      // Listen for refresh events\n      const handleRefresh = () => {\n        resetMessages();\n      };\n      \n      // Store the handler so we can clean it up\n      window.addEventListener('refreshChat', handleRefresh);\n      \n      return () => {\n        window.removeEventListener('refreshChat', handleRefresh);\n      };\n    }\n  }, [onRefresh]);\n\n  // Auto-scroll to latest message\n  React.useEffect(() => {\n    try {\n      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    } catch (e) {\n      // ignore scroll errors\n    }\n  }, [messages, isGeneratingKundli, isGeneratingChart, chartData]);\n\n  // Auto-focus input when chat opens or bot finished typing\n  React.useEffect(() => {\n    if (isOpen && !isBotTyping && !isGeneratingKundli) {\n      try { inputRef.current?.focus(); } catch (e) {}\n    }\n  }, [isOpen, isBotTyping, isGeneratingKundli]);\n\n  // NLP helpers for stepwise extraction\n  const parseName = (text) => {\n    const input = text.trim();\n    const cleanup = (raw) => {\n      if (!raw) return null;\n      // Remove trailing Hindi copula words like 'hai', 'hun', 'hu'\n      let name = raw.replace(/\\b(hai|hun|hu|hoon)\\b\\.?$/i, '').trim();\n      // Remove trailing punctuation\n      name = name.replace(/[.,;:!?]+$/g, '').trim();\n      // Collapse multiple spaces\n      name = name.replace(/\\s{2,}/g, ' ');\n      return name || null;\n    };\n\n    // 1) \"mera naam <name> hai\" (common Hindi pattern)\n    let m = input.match(/(?:^|\\b)mera\\s+naam\\s+([a-zA-Z][a-zA-Z\\s'.-]*?)(?:\\s+(?:hai|hun|hu|hoon))?\\b/i);\n    if (m) return cleanup(m[1]);\n\n    // 2) \"my name is <name>\"\n    m = input.match(/(?:^|\\b)my\\s+name\\s+is\\s+([a-zA-Z][a-zA-Z\\s'.-]+)$/i);\n    if (m) return cleanup(m[1]);\n\n    // 3) \"I am <name>\" or \"I'm <name>\"\n    m = input.match(/^(?:i\\s*am|i'm)\\s+([a-zA-Z][a-zA-Z\\s'.-]+)$/i);\n    if (m) return cleanup(m[1]);\n\n    // 4) Bare name fallback (single or multi-word letters only)\n    m = input.match(/^([a-zA-Z][a-zA-Z\\s'.-]{1,})$/);\n    if (m) return cleanup(m[1]);\n\n    return null;\n  };\n\n  const parseDob = (text) => {\n    const monthNames = ['january','february','march','april','may','june','july','august','september','october','november','december'];\n    const monthShort = ['jan','feb','mar','apr','may','jun','jul','aug','sep','oct','nov','dec'];\n    let m;\n    m = text.match(/(\\d{4})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{1,2})/); // YYYY-MM-DD\n    if (m) return `${m[1]}-${m[2].padStart(2,'0')}-${m[3].padStart(2,'0')}`;\n    m = text.match(/(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{4})/); // DD-MM-YYYY or MM-DD-YYYY\n    if (m) {\n      const a = parseInt(m[1],10), b = parseInt(m[2],10);\n      // Heuristic: if both <=12, assume DD-MM-YYYY by default\n      const day = a; const month = b;\n      return `${m[3]}-${month.toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;\n    }\n    m = text.match(/(\\d{1,2})\\s+(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\\s+(\\d{4})/i);\n    if (m) {\n      const month = monthNames.indexOf(m[2].toLowerCase()) !== -1 \n        ? monthNames.indexOf(m[2].toLowerCase()) + 1\n        : monthShort.indexOf(m[2].toLowerCase()) + 1;\n      return `${m[3]}-${month.toString().padStart(2,'0')}-${m[1].padStart(2,'0')}`;\n    }\n    return null;\n  };\n\n  const parseTob = (text) => {\n    let m = text.match(/(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(am|pm)?/i);\n    if (!m) m = text.match(/(\\d{1,2})[\\.\\s](\\d{2})\\s*(am|pm)?/i);\n    if (m) {\n      let hour = parseInt(m[1],10);\n      const minute = m[2];\n      const sec = m[3] || '00';\n      const period = (m[4] || m[3]) || '';\n      if (/pm/i.test(period) && hour !== 12) hour += 12;\n      if (/am/i.test(period) && hour === 12) hour = 0;\n      if (hour >= 0 && hour <= 23) return `${hour.toString().padStart(2,'0')}:${minute}:${sec}`;\n    }\n    return null;\n  };\n\n  const parsePlace = (text) => {\n    const m = text.match(/(?:place|sthan|city|town|birth\\s*place|janm\\s*sthan|from|in)\\s*:?\\s*([a-zA-Z][a-zA-Z\\s,.'-]+)/i);\n    if (m) return m[1].trim();\n    // Fallback: single word or two words capitalized\n    const m2 = text.match(/^[a-zA-Z][a-zA-Z\\s'.-]{2,}$/);\n    if (m2) return m2[0].trim();\n    return null;\n  };\n\n  const isValidDate = (yyyyMmDd) => {\n    if (!yyyyMmDd) return false;\n    const m = yyyyMmDd.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (!m) return false;\n    const d = new Date(`${m[1]}-${m[2]}-${m[3]}T00:00:00Z`);\n    return !isNaN(d.getTime());\n  };\n\n  const isValidTime = (hhmmss) => /^(\\d{2}):(\\d{2}):(\\d{2})$/.test(hhmmss);\n\n  // Helper function to check if all birth details are collected\n  const isProfileComplete = () => {\n    return userProfile.name && userProfile.dob && userProfile.tob && userProfile.place;\n  };\n\n  // Helper function to generate Kundli and Chart\n  const generateKundli = async () => {\n    setIsGeneratingKundli(true);\n    setIsGeneratingChart(true);\n    setCurrentStep('generating');\n    \n    try {\n      const birthDetails = {\n        name: userProfile.name,\n        dob: userProfile.dob,\n        tob: userProfile.tob,\n        place: userProfile.place,\n        timezone: userProfile.timezone\n      };\n      \n      // Generate both chart and kundli data in parallel\n      const [chartResponse, kundliResponse] = await Promise.all([\n        astroBotAPI.generateChart(birthDetails),\n        astroBotAPI.generateKundli(birthDetails)\n      ]);\n      \n      if (chartResponse.success && chartResponse.chart_data) {\n        setChartData(chartResponse.chart_data);\n        setIsGeneratingChart(false);\n      }\n      \n      if (kundliResponse.success && kundliResponse.chart_data) {\n        setKundliData(kundliResponse.chart_data);\n        setCurrentStep('chart_generated');\n        \n        // Add Kundli generation success message\n        const successMessage = {\n          id: nextMessageId(),\n          text: `🎉 ${userProfile.name} ji, aapka Kundli chart taiyar hai! Ab aap koi bhi sawal puch sakte hain - grah ki sthiti, dasha, yog, ya koi bhi astrological prediction ke bare mein.`,\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        };\n        setMessages(prev => [...prev, successMessage]);\n      } else {\n        throw new Error(kundliResponse.error || 'Kundli generation failed');\n      }\n    } catch (error) {\n      console.error('Error generating Kundli:', error);\n      const errorMessage = {\n        id: nextMessageId(),\n        text: \"Sorry, Kundli generate karne mein koi problem aa rahi hai. Kripya dobara try karein ya contact karein.\",\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsGeneratingKundli(false);\n    }\n  };\n\n  // Helper function to generate Kundli with user data from form\n  const generateKundliWithUserData = async (data) => {\n    setIsGeneratingKundli(true);\n    setIsGeneratingChart(true);\n    \n    try {\n      // Generate both chart and kundli data in parallel\n      const [chartResponse, kundliResponse] = await Promise.all([\n        astroBotAPI.generateChart(data),\n        astroBotAPI.generateKundli(data)\n      ]);\n      \n      if (chartResponse.success && chartResponse.chart_data) {\n        setChartData(chartResponse.chart_data);\n        setIsGeneratingChart(false);\n      }\n      \n      if (kundliResponse.success && kundliResponse.chart_data) {\n        setKundliData(kundliResponse.chart_data);\n        setCurrentStep('chart_generated');\n        \n        // Add Kundli generation success message\n        const successMessage = {\n          id: nextMessageId(),\n          text: `🎉 ${data.name} ji, aapka Kundli chart taiyar hai! Ab aap koi bhi sawal puch sakte hain - grah ki sthiti, dasha, yog, ya koi bhi astrological prediction ke bare mein.`,\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString()\n        };\n        setMessages(prev => [...prev, successMessage]);\n      } else {\n        throw new Error(kundliResponse.error || 'Kundli generation failed');\n      }\n    } catch (error) {\n      console.error('Error generating Kundli:', error);\n      const errorMessage = {\n        id: nextMessageId(),\n        text: \"Sorry, Kundli generate karne mein koi problem aa rahi hai. Kripya dobara try karein ya contact karein.\",\n        sender: 'pandit',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsGeneratingKundli(false);\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (inputText.trim()) {\n      const newMessage = {\n        id: nextMessageId(),\n        text: inputText,\n        sender: 'user',\n        timestamp: new Date().toLocaleTimeString()\n      };\n      \n      setMessages([...messages, newMessage]);\n      const currentInput = inputText;\n      setInputText('');\n      \n      try {\n        // Show typing indicator\n        const typingMessage = {\n          id: nextMessageId(),\n          text: \"Pandit ji typing...\",\n          sender: 'pandit',\n          timestamp: new Date().toLocaleTimeString(),\n          isTyping: true\n        };\n        setIsBotTyping(true);\n        setMessages(prev => [...prev, typingMessage]);\n        \n        // Stepwise dialog\n        let botText = '';\n        if (currentStep === 'ask_name') {\n          // allow corrections like: name: Rajesh\n          let name = null;\n          const correction = currentInput.match(/^(?:name|naam)\\s*[:\\-]\\s*(.+)$/i);\n          if (correction) name = correction[1].trim();\n          if (!name) name = parseName(currentInput);\n          if (!name) {\n            botText = \"Kripya apna naam clear tarike se batayiye (e.g., Mera naam Anil hai).\";\n          } else {\n            const updated = { ...userProfile, name };\n            setUserProfile(updated);\n            setCurrentStep('ask_dob');\n            botText = `${name} ji, ab apni janm tithi batayiye (e.g., 15/05/1990 ya 15 May 1990).`;\n          }\n        } else if (currentStep === 'ask_dob') {\n          const dob = parseDob(currentInput);\n          if (!dob || !isValidDate(dob)) {\n            botText = \"Janm tithi samajh nahi aayi. Kripya format mein batayein: DD/MM/YYYY ya 15 May 1990.\";\n          } else {\n            const updated = { ...userProfile, dob };\n            setUserProfile(updated);\n            setCurrentStep('ask_tob');\n            botText = \"Shukriya. Ab apna janm samay batayiye (e.g., 2:30 PM ya 14:30).\";\n          }\n        } else if (currentStep === 'ask_tob') {\n          const tob = parseTob(currentInput);\n          if (!tob || !isValidTime(tob)) {\n            botText = \"Janm samay samajh nahi aaya. Kripya format mein batayein: HH:MM AM/PM ya 24-hour (e.g., 14:30).\";\n          } else {\n            const updated = { ...userProfile, tob };\n            setUserProfile(updated);\n            setCurrentStep('ask_place');\n            botText = \"Samay mil gaya. Ab apna janm sthan/city batayiye (e.g., Delhi, Mumbai).\";\n          }\n        } else if (currentStep === 'ask_place') {\n          const place = parsePlace(currentInput);\n          if (!place) {\n            botText = \"Janm sthan samajh nahi aaya. Kripya city ka naam batayein (e.g., Pune).\";\n          } else {\n            const updated = { ...userProfile, place };\n            setUserProfile(updated);\n            setCurrentStep('confirm_details');\n            botText = `Kripya confirm karein:\\n- Naam: ${updated.name}\\n- DOB: ${updated.dob}\\n- TOB: ${updated.tob}\\n- Place: ${updated.place}\\nType karein: 'yes' ya jis field ko change karna ho: 'change name: <naya naam>'`;\n          }\n        } else if (currentStep === 'confirm_details') {\n          if (/^y(es)?$/i.test(currentInput.trim())) {\n            botText = \"Bahut badiya! Main aapka Kundli chart generate kar raha hun...\";\n            setCurrentStep('generating');\n            // proceed without removing typing bubble\n        setMessages(prev => prev.filter(msg => !msg.isTyping).concat({\n          id: nextMessageId(),\n              text: botText,\n              sender: 'pandit',\n              timestamp: new Date().toLocaleTimeString()\n            }));\n            await generateKundli();\n            return;\n          }\n          const change = currentInput.match(/^change\\s+(name|naam|dob|date|tob|time|samay|place|city|sthan)\\s*[:\\-]\\s*(.+)$/i);\n          if (change) {\n            const field = change[1].toLowerCase();\n            const value = change[2].trim();\n            const updated = { ...userProfile };\n            if (field === 'name' || field === 'naam') updated.name = value;\n            else if (field === 'dob' || field === 'date') {\n              const dob = parseDob(value);\n              if (dob && isValidDate(dob)) updated.dob = dob; else {\n                botText = \"Nayi DOB valid nahi hai. Example: 15/05/1990\";\n              }\n            } else if (field === 'tob' || field === 'time' || field === 'samay') {\n              const tob = parseTob(value);\n              if (tob && isValidTime(tob)) updated.tob = tob; else {\n                botText = \"Naya TOB valid nahi hai. Example: 2:30 PM ya 14:30\";\n              }\n            } else if (field === 'place' || field === 'city' || field === 'sthan') {\n              const place = parsePlace(value);\n              if (place) updated.place = place; else {\n                botText = \"Naya place samajh nahi aaya. Example: Jaipur\";\n              }\n            }\n            setUserProfile(updated);\n            if (!botText) {\n              botText = `Updated. Kripya confirm karein:\\n- Naam: ${updated.name}\\n- DOB: ${updated.dob}\\n- TOB: ${updated.tob}\\n- Place: ${updated.place}\\nType 'yes' ya 'change <field>: <value>'`;\n            }\n          } else {\n            botText = \"Kripya 'yes' type karein ya 'change <field>: <value>' batayein (e.g., change dob: 1990-05-15).\";\n          }\n        } else if (currentStep === 'chart_generated' || currentStep === 'chatting') {\n          // Regular chat with chart context\n          const response = await astroBotAPI.sendChatMessage(currentInput, chartData);\n          botText = response.response;\n          setCurrentStep('chatting');\n        } else if (currentStep === 'generating') {\n          botText = \"Chart generate ho raha hai, kripya wait karein...\";\n        }\n\n        // Smooth typing simulation with thoughtful delay for predictions\n        const looksLikePrediction = /\\b(yog|shaadi|career|health|mangal|grah|kundli|prediction|yoga)\\b/i.test(botText || '');\n        const baseDelay = looksLikePrediction ? 8000 : 600; // ~8s for predictions, shorter otherwise\n        const variableDelay = Math.min(2000, Math.floor((botText?.length || 0) / 12) * 60);\n        const delayMs = baseDelay + variableDelay;\n        await new Promise(res => setTimeout(res, delayMs));\n        // Remove typing indicator and add botText\n        setMessages(prev => {\n          const withoutTyping = prev.filter(msg => !msg.isTyping);\n          return [...withoutTyping, {\n            id: nextMessageId(),\n            text: botText,\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          }];\n        });\n        // Optionally add a gentle follow-up question to keep flow natural\n        if (currentStep === 'chatting' || currentStep === 'chart_generated') {\n          const followUps = [\n            \"Abhi aapke rishte ki baat chal rahi hai kya?\",\n            \"Kya aap kisi ko pasand karte ho?\",\n            \"Aapka career kis field mein hai?\",\n            \"Aapko apni health ke baare mein bhi jaana hai kya?\"\n          ];\n          const fupDelay = 1200 + Math.floor(Math.random() * 1200);\n          setTimeout(() => {\n            setMessages(prev => ([...prev, {\n              id: nextMessageId(),\n              text: followUps[Math.floor(Math.random() * followUps.length)],\n              sender: 'pandit',\n              timestamp: new Date().toLocaleTimeString()\n            }]));\n          }, fupDelay);\n        }\n        setIsBotTyping(false);\n        \n      } catch (error) {\n        console.error('Error sending message:', error);\n        \n        // Remove typing indicator and show error\n        setMessages(prev => {\n          const withoutTyping = prev.filter(msg => !msg.isTyping);\n          const errorResponse = {\n            id: nextMessageId(),\n            text: \"Sorry, main abhi online nahi hun. Kripya thoda baad try karein.\",\n            sender: 'pandit',\n            timestamp: new Date().toLocaleTimeString()\n          };\n          return [...withoutTyping, errorResponse];\n        });\n        setIsBotTyping(false);\n      }\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      handleSendMessage();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className={`expandable-chat-container ${isOpen ? 'expanded' : ''}`}>\n      {/* Chat Header */}\n      <div className=\"chat-header\">\n        <div className=\"pandit-info\">\n          <div className=\"pandit-avatar-small\">\n            <img src={require('../assets/Astro_Avatar.png')} alt=\"Pandit ji\" />\n          </div>\n          <div className=\"pandit-details\">\n            <h3>Pandit ji</h3>\n            <span className=\"status\">Online</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Messages Area */}\n      <div className=\"messages-container\">\n        {messages.map((message) => (\n          <div key={message.id} className={`message ${message.sender}`}>\n            {message.sender === 'pandit' && (\n              <div className=\"message-avatar\">\n                <img src={require('../assets/Astro_Avatar.png')} alt=\"Pandit ji\" />\n              </div>\n            )}\n            <div className=\"message-content\">\n              <div className=\"message-bubble\">\n                <p>{message.text}</p>\n                <span className=\"message-time\">{message.timestamp}</span>\n              </div>\n            </div>\n          </div>\n        ))}\n        <div ref={messagesEndRef} />\n        \n        {/* Kundli Chart Display */}\n        {chartData && (\n          <KundliChart \n            chartData={chartData} \n            onChartReady={() => {\n              // Chart is ready, no need for additional message\n              console.log('Chart loaded successfully');\n            }}\n          />\n        )}\n        \n        {/* Loading indicator for Kundli generation */}\n        {(isGeneratingKundli || isGeneratingChart) && (\n          <div className=\"kundli-loading\">\n            <div className=\"loading-spinner\"></div>\n            <p>🔮 Aapka Kundli chart generate ho raha hai... Kripya wait karein</p>\n          </div>\n        )}\n      </div>\n\n      {/* Input Area */}\n      <div className=\"input-container\">\n        <div className=\"input-wrapper\">\n          <input\n            type=\"text\"\n            value={inputText}\n            onChange={(e) => setInputText(e.target.value)}\n            onKeyPress={handleKeyPress}\n            ref={inputRef}\n            placeholder={\n              currentStep === 'greeting' || currentStep === 'collecting_details'\n                ? \"Format: naam, DD/MM/YYYY, HH:MM, place (e.g., Rajesh, 15/05/1990, 14:30, Delhi)\"\n                : \"Apna sawal yahan likhein...\"\n            }\n            className=\"message-input\"\n            disabled={isGeneratingKundli || isBotTyping}\n          />\n          <button \n            onClick={handleSendMessage} \n            className=\"send-button\"\n            disabled={isGeneratingKundli || isBotTyping}\n          >\n            <svg viewBox=\"0 0 24 24\" className=\"send-icon\">\n              <path d=\"M22 2L11 13\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n              <path d=\"M22 2L15 22L11 13L2 9L22 2Z\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            </svg>\n          </button>\n          {(currentStep === 'confirm_details' || currentStep === 'chart_generated' || currentStep === 'chatting') && (\n            <button\n              onClick={() => {\n                setEditMode((prev) => !prev);\n                if (!editMode) {\n                  // entering edit mode: show current details\n                  const m = {\n                    id: nextMessageId(),\n                    text: `Edit mode enabled. Type: change name: <value> / change dob: <value> / change tob: <value> / change place: <value>. Then type 'save' to confirm.`,\n                    sender: 'pandit',\n                    timestamp: new Date().toLocaleTimeString()\n                  };\n                  setMessages((prev) => [...prev, m]);\n                }\n              }}\n              className=\"send-button\"\n              style={{ marginLeft: 8 }}\n            >\n              {editMode ? 'Done' : 'Edit details'}\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ExpandableChat;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}